function load_ispeak(){if(!document.querySelectorAll("#ispeak")[0])return;["https://cdn.jsdmirror.com/npm/ispeak/ispeak.umd.js","https://s4.zstatic.net/ajax/libs/highlight.js/10.6.0/highlight.min.js","https://s4.zstatic.net/ajax/libs/marked/2.0.0/marked.min.js","https://s4.zstatic.net/ajax/libs/twikoo/1.6.38/twikoo.all.min.js "].forEach((t=>{if(![...document.scripts].some((e=>e.src===t))){const e=document.createElement("script");e.src=t,e.setAttribute("data-no-instant",""),e.async=!1,document.body.appendChild(e)}}))}function pjax_ispeak(){document.querySelectorAll("#ispeak")[0]&&ispeak.init({el:"#ispeak",api:"https://kkapi.keee.top/",author:"633aaa45d0d52c818b1cf9c1",pageSize:10,loading_img:"/img/iloading.svg",comment:function(t){const{_id:e,title:o,content:i}=t;i.substring(0,30);twikoo.init({envId:"https://twikoo-netlify-c.netlify.app/.netlify/functions/twikoo",el:".ispeak-comment",path:"/speak/info.html?q="+e,lang:"zh-CN"})}})}class SummaryHandler{constructor(t){if(this.backendUrl=t.backendUrl||"https://qwen.keee.top",this.contentCursor=document.getElementById(t.contentId||"markd-content"),this.outputCursor=document.getElementById(t.outputId||"post-ai-result-text"),this.loadingText=document.getElementById(t.loadingId||"result-loading"),this.aiLogoCursor=document.getElementById(t.logoId||"ai-logo"),this.postTitleCursor=document.getElementsByClassName(t.titleClass||"article-title"),!this.outputCursor||!this.contentCursor||!this.aiLogoCursor)throw new Error("Required DOM elements are missing.");this.apiUrl=this.backendUrl.endsWith("/")?`${this.backendUrl}api/summary`:`${this.backendUrl}/api/summary`,this.typingTimeout=null,this.shouldDisable=!1,this.summaryData=void 0,this.init()}init(){const t=new URL(location.href);this.postId=t.pathname.split("/").filter((t=>""!==t)).pop(),this.content=this.contentCursor.textContent,this.requestBody={postId:this.postId,content:this.content},this.fetchSummary()}addCursor(){if(this.outputCursor){if(!this.outputCursor.querySelector(".ai-cursor")){const t=document.createElement("span");t.className="ai-cursor",this.outputCursor.appendChild(t)}}else console.error("Output cursor element is missing.")}typeWriter(t,e){this.loadingText&&this.loadingText.remove(),this.aiLogoCursor.classList.add("typing");const o=this.outputCursor.querySelector(".ai-cursor");o?t<e.length?(o.insertAdjacentText("beforebegin",e.charAt(t)),this.typingTimeout=setTimeout((()=>this.typeWriter(t+1,e)),20)):(this.aiLogoCursor.classList.remove("typing"),o.remove(),this.shouldDisable=!1):console.error("Cursor element is missing. Please ensure addCursor is called before typeWriter.")}inputSummary(t){const e=t;this.shouldDisable=!0,clearTimeout(this.typingTimeout),this.addCursor(),this.typeWriter(0,e)}fetchSummary(){fetch(`${this.apiUrl}?postId=${this.postId}`,{method:"GET"}).then((t=>t.json())).then((t=>{t.isSave?(this.summaryData=t.data,this.inputSummary(t.data)):this.postSummary()})).catch((t=>{this.outputCursor.textContent=`${t}`,console.error("Fetch error:",t)}))}postSummary(){fetch(this.apiUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(this.requestBody)}).then((t=>t.json())).then((t=>{1===t.code?(this.summaryData=t.data,this.inputSummary(t.data)):console.error("Error:",t)})).catch((t=>{this.outputCursor.textContent=`${t}`,console.error("Fetch error:",t)}))}}function fetchHitokoto(t={}){const{apiUrl:e="https://v1.hitokoto.cn",hitokotoElementId:o="hitokoto_all",clickElementId:i="hitokoto_text"}=t,s=document.getElementById(o),n=document.getElementById(i);if(!s||!n)return void console.error("指定的元素未找到，请检查元素 ID 是否正确。");let r=0;n.addEventListener("click",(t=>{t.preventDefault(),r++,s.innerText=1===r?"别急，我在思考🤔":2===r?"别急，我还在思考🤔":r<=10?`你已经点击了 ${r} 次🤣`:"憋点了😅"})),fetch(e).then((t=>t.json())).then((t=>{s.innerText=t.hitokoto,t.from_who&&(s.innerText+=`  —— ${t.from_who}`),t.from&&(s.innerText+=`《${t.from}》`)})).catch((t=>{console.error("获取 Hitokoto 失败：",t)}))}document.addEventListener("DOMContentLoaded",load_ispeak),document.addEventListener("DOMContentLoaded",fetchHitokoto),InstantClick.on("change",load_ispeak),InstantClick.on("change",pjax_ispeak),InstantClick.on("change",(()=>{document.querySelectorAll("#markd-content")[0]&&new SummaryHandler({backendUrl:"https://qwen.keee.top",contentId:"markd-content",outputId:"post-ai-result-text",loadingId:"result-loading",logoId:"ai-logo",titleClass:"article-title"})})),InstantClick.on("change",(()=>{fetchHitokoto({apiUrl:"https://v1.hitokoto.cn",hitokotoElementId:"hitokoto_all",clickElementId:"hitokoto_text"})}));